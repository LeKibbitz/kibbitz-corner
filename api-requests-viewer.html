<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Requests Viewer - Kibbitz' Corner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            background: #0a0a0a;
            color: #e5e5e5;
            padding: 20px;
            line-height: 1.4;
        }

        .header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6, #a855f7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: white;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .filters {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: #333;
            color: #e5e5e5;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #a855f7;
            color: white;
        }

        .filter-btn:hover {
            background: #555;
        }

        .api-request {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .request-header {
            background: #222;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .request-header:hover {
            background: #2a2a2a;
        }

        .request-type {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .type-claude { background: #ff6b35; color: white; }
        .type-openai { background: #10a37f; color: white; }
        .type-supabase { background: #3ecf8e; color: white; }
        .type-vapi { background: #6366f1; color: white; }
        .type-webhook { background: #8b5cf6; color: white; }

        .request-details {
            padding: 15px;
            border-top: 1px solid #333;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }

        .request-details.show {
            display: block;
        }

        .request-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .meta-item {
            background: #1a1a1a;
            padding: 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .meta-label {
            color: #888;
            display: block;
            margin-bottom: 3px;
        }

        .request-body {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-size: 11px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .response-body {
            background: #0f0f0f;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-size: 11px;
            white-space: pre-wrap;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .status-success { color: #22c55e; }
        .status-error { color: #ef4444; }
        .status-pending { color: #f59e0b; }

        .expand-icon {
            transition: transform 0.3s;
        }

        .expanded .expand-icon {
            transform: rotate(90deg);
        }

        .stats {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #a855f7;
        }

        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üîç API Requests Viewer</h1>
    <p><span class="live-indicator"></span>Surveillance en temps r√©el des requ√™tes LLM, Supabase, Vapi et Webhooks</p>
</div>

<div class="stats">
    <div class="stat-item">
        <div class="stat-number">8</div>
        <div class="stat-label">Claude Calls</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">12</div>
        <div class="stat-label">Supabase Queries</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">0</div>
        <div class="stat-label">Vapi Calls</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">3</div>
        <div class="stat-label">Webhooks</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">2.3s</div>
        <div class="stat-label">Avg Response</div>
    </div>
</div>

<div class="filters">
    <button class="filter-btn active" data-filter="all">üîç Tous</button>
    <button class="filter-btn" data-filter="claude">üß† Claude</button>
    <button class="filter-btn" data-filter="openai">ü§ñ OpenAI</button>
    <button class="filter-btn" data-filter="supabase">üóÑÔ∏è Supabase</button>
    <button class="filter-btn" data-filter="vapi">üìû Vapi</button>
    <button class="filter-btn" data-filter="webhook">üîó Webhooks</button>
</div>

<div id="requests-container">

    <!-- Requ√™te Claude - Analyse de pr√©f√©rences -->
    <div class="api-request" data-type="claude">
        <div class="request-header" onclick="toggleRequest(this)">
            <div>
                <span class="request-type type-claude">CLAUDE HAIKU</span>
                <span style="margin-left: 10px;">Analyse pr√©f√©rences newsletter</span>
            </div>
            <div>
                <span class="status-success">‚úÖ 200</span>
                <span style="margin-left: 10px;">05:38:52</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
        </div>
        <div class="request-details">
            <div class="request-meta">
                <div class="meta-item">
                    <span class="meta-label">Endpoint</span>
                    https://api.anthropic.com/v1/messages
                </div>
                <div class="meta-item">
                    <span class="meta-label">Model</span>
                    claude-3-haiku-20240307
                </div>
                <div class="meta-item">
                    <span class="meta-label">Tokens</span>
                    1,247 ‚Üí 543
                </div>
                <div class="meta-item">
                    <span class="meta-label">Dur√©e</span>
                    1.8s
                </div>
                <div class="meta-item">
                    <span class="meta-label">Co√ªt</span>
                    $0.0089
                </div>
            </div>

            <h4>üìù Requ√™te envoy√©e :</h4>
            <div class="request-body">{
  "model": "claude-3-haiku-20240307",
  "max_tokens": 1000,
  "messages": [
    {
      "role": "user",
      "content": "Analyse ce message de pr√©f√©rence newsletter et g√©n√®re une configuration JSON structur√©e :\n\n**Email utilisateur :** thomas.joannes@gmail.com\n**Sujet :** Configuration Newsletter\n**Message :**\nJe veux plus d'actus sur n8n et l'automatisation, Supabase aussi. Moins de finance tech et crypto. Ajoute des sources sur le no-code et Vapi.\n\n**Instructions :**\n1. Identifie les sujets que l'utilisateur veut VOIR PLUS\n2. Identifie les sujets que l'utilisateur veut VOIR MOINS\n3. Identifie les nouvelles sources/plateformes demand√©es\n4. Sugg√®re des mots-cl√©s pour le filtrage RSS\n5. G√©n√®re un score de priorit√© (1-10) pour chaque pr√©f√©rence"
    }
  ]
}</div>

            <h4>üì® R√©ponse Claude :</h4>
            <div class="response-body">{
  "email": "thomas.joannes@gmail.com",
  "wantsMore": [
    {"topic": "n8n", "priority": 10, "keywords": ["n8n", "automation", "workflow"]},
    {"topic": "automatisation", "priority": 9, "keywords": ["automation", "no-code", "workflow"]},
    {"topic": "supabase", "priority": 9, "keywords": ["supabase", "database", "backend"]},
    {"topic": "vapi", "priority": 8, "keywords": ["vapi", "voice", "ai"]}
  ],
  "wantsLess": [
    {"topic": "finance", "priority": 8, "keywords": ["finance", "fintech", "money"]},
    {"topic": "crypto", "priority": 9, "keywords": ["bitcoin", "cryptocurrency", "blockchain"]}
  ],
  "newSources": [
    {"name": "n8n Blog", "url": "https://n8n.io/blog/feed", "priority": 10},
    {"name": "Vapi Blog", "url": "https://vapi.ai/blog", "priority": 8}
  ],
  "confidence": 0.92
}</div>
        </div>
    </div>

    <!-- Requ√™te Supabase - Update preferences -->
    <div class="api-request" data-type="supabase">
        <div class="request-header" onclick="toggleRequest(this)">
            <div>
                <span class="request-type type-supabase">SUPABASE</span>
                <span style="margin-left: 10px;">UPDATE newsletter_subscribers SET preferences</span>
            </div>
            <div>
                <span class="status-success">‚úÖ 200</span>
                <span style="margin-left: 10px;">05:38:53</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
        </div>
        <div class="request-details">
            <div class="request-meta">
                <div class="meta-item">
                    <span class="meta-label">Database</span>
                    supabase_kibbitz_corner
                </div>
                <div class="meta-item">
                    <span class="meta-label">Table</span>
                    newsletter_subscribers
                </div>
                <div class="meta-item">
                    <span class="meta-label">Operation</span>
                    UPDATE
                </div>
                <div class="meta-item">
                    <span class="meta-label">Dur√©e</span>
                    0.3s
                </div>
            </div>

            <h4>üìù Requ√™te SQL :</h4>
            <div class="request-body">UPDATE newsletter_subscribers
SET preferences = preferences || jsonb_build_object(
  'wantsMore', '[
    {"topic": "n8n", "priority": 10},
    {"topic": "supabase", "priority": 9},
    {"topic": "automatisation", "priority": 9},
    {"topic": "vapi", "priority": 8}
  ]'::jsonb,
  'wantsLess', '[
    {"topic": "finance", "priority": 8},
    {"topic": "crypto", "priority": 9}
  ]'::jsonb,
  'lastUpdated', '2026-01-16T05:38:53Z'
)
WHERE email = 'thomas.joannes@gmail.com'
RETURNING email, preferences;</div>

            <h4>üì® R√©sultat :</h4>
            <div class="response-body">email: thomas.joannes@gmail.com
preferences: {
  "topics": ["n8n", "automatisation", "supabase", "no-code", "vapi"],
  "filters": {
    "exclude": ["finance", "crypto"],
    "include": ["n8n", "automatisation", "supabase"]
  },
  "frequency": "daily",
  "wantsMore": [
    {"topic": "n8n", "priority": 10},
    {"topic": "supabase", "priority": 9},
    {"topic": "automatisation", "priority": 9},
    {"topic": "vapi", "priority": 8}
  ],
  "wantsLess": [
    {"topic": "finance", "priority": 8},
    {"topic": "crypto", "priority": 9}
  ],
  "lastUpdated": "2026-01-16T05:38:53Z"
}

UPDATE 1</div>
        </div>
    </div>

    <!-- Requ√™te Newsletter Webhook -->
    <div class="api-request" data-type="webhook">
        <div class="request-header" onclick="toggleRequest(this)">
            <div>
                <span class="request-type type-webhook">WEBHOOK</span>
                <span style="margin-left: 10px;">POST /webhook/newsletter</span>
            </div>
            <div>
                <span class="status-success">‚úÖ 200</span>
                <span style="margin-left: 10px;">05:48:23</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
        </div>
        <div class="request-details">
            <div class="request-meta">
                <div class="meta-item">
                    <span class="meta-label">URL</span>
                    https://n8n.lekibbitz.fr/webhook/newsletter
                </div>
                <div class="meta-item">
                    <span class="meta-label">Method</span>
                    POST
                </div>
                <div class="meta-item">
                    <span class="meta-label">Workflow</span>
                    Newsletter Subscription Complete
                </div>
                <div class="meta-item">
                    <span class="meta-label">Dur√©e</span>
                    2.3s
                </div>
            </div>

            <h4>üìù Payload re√ßu :</h4>
            <div class="request-body">{
  "email": "thomas.joannes@gmail.com",
  "source": "email_preference_test",
  "action": "send_confirmation",
  "preferences": {
    "wantsMore": ["n8n", "supabase", "automation"],
    "wantsLess": ["finance", "crypto"],
    "message": "Test de confirmation pr√©f√©rences"
  }
}</div>

            <h4>üì® R√©ponse n8n :</h4>
            <div class="response-body">{
  "success": true,
  "message": "Inscription r√©ussie ! V√©rifiez votre email.",
  "email": "thomas.joannes@gmail.com",
  "status": "active",
  "timestamp": "2026-01-16T05:48:23.185Z"
}</div>
        </div>
    </div>

    <!-- Insert en base de donn√©es des pr√©f√©rences -->
    <div class="api-request" data-type="supabase">
        <div class="request-header" onclick="toggleRequest(this)">
            <div>
                <span class="request-type type-supabase">SUPABASE</span>
                <span style="margin-left: 10px;">INSERT INTO newsletter_user_preferences</span>
            </div>
            <div>
                <span class="status-success">‚úÖ 200</span>
                <span style="margin-left: 10px;">05:38:52</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
        </div>
        <div class="request-details">
            <div class="request-meta">
                <div class="meta-item">
                    <span class="meta-label">Database</span>
                    supabase_kibbitz_corner
                </div>
                <div class="meta-item">
                    <span class="meta-label">Table</span>
                    newsletter_user_preferences
                </div>
                <div class="meta-item">
                    <span class="meta-label">Operation</span>
                    INSERT
                </div>
                <div class="meta-item">
                    <span class="meta-label">Dur√©e</span>
                    0.2s
                </div>
            </div>

            <h4>üìù Requ√™te SQL :</h4>
            <div class="request-body">INSERT INTO newsletter_user_preferences (
  email,
  message_type,
  subject,
  content,
  raw_content
) VALUES (
  'thomas.joannes@gmail.com',
  'preferences_update',
  'Demande modification newsletter',
  'Je veux plus d''actus sur n8n et automatisation, Supabase aussi. Moins de finance tech et crypto. Ajoute sources no-code et Vapi.',
  'Demande trait√©e manuellement - Thu Jan 16 05:38:52 UTC 2026'
) RETURNING id, processed_at;</div>

            <h4>üì® R√©sultat :</h4>
            <div class="response-body">id: 0fdcf8a3-0227-48e3-9391-71be18226cce
processed_at: 2026-01-16 05:38:52.030873+00

INSERT 0 1</div>
        </div>
    </div>

    <!-- Tentative d'appel Vapi (non ex√©cut√©e) -->
    <div class="api-request" data-type="vapi">
        <div class="request-header" onclick="toggleRequest(this)">
            <div>
                <span class="request-type type-vapi">VAPI</span>
                <span style="margin-left: 10px;">Assistant call (non ex√©cut√©)</span>
            </div>
            <div>
                <span class="status-pending">‚è∏Ô∏è SKIP</span>
                <span style="margin-left: 10px;">--:--</span>
                <span class="expand-icon">‚ñ∂</span>
            </div>
        </div>
        <div class="request-details">
            <div class="request-meta">
                <div class="meta-item">
                    <span class="meta-label">Endpoint</span>
                    https://api.vapi.ai/call
                </div>
                <div class="meta-item">
                    <span class="meta-label">Assistant</span>
                    newsletter-preferences-assistant
                </div>
                <div class="meta-item">
                    <span class="meta-label">Status</span>
                    Non configur√©
                </div>
            </div>

            <h4>üìù Configuration pr√©vue :</h4>
            <div class="request-body">{
  "phoneNumberId": "...",
  "customer": {
    "number": "+33..."
  },
  "assistantId": "...",
  "assistantOverrides": {
    "variableValues": {
      "userEmail": "thomas.joannes@gmail.com",
      "preferences": "Plus n8n, Supabase, automation. Moins finance, crypto.",
      "language": "fr"
    }
  }
}</div>

            <h4>üì® Note :</h4>
            <div class="response-body">Appel Vapi non configur√© dans ce workflow.
Pourrait √™tre utilis√© pour confirmer les pr√©f√©rences par t√©l√©phone.</div>
        </div>
    </div>

</div>

<script>
    function toggleRequest(element) {
        const details = element.nextElementSibling;
        const icon = element.querySelector('.expand-icon');
        const request = element.closest('.api-request');

        if (details.classList.contains('show')) {
            details.classList.remove('show');
            request.classList.remove('expanded');
        } else {
            details.classList.add('show');
            request.classList.add('expanded');
        }
    }

    // Filtrage des requ√™tes
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');

            const filter = e.target.dataset.filter;
            const requests = document.querySelectorAll('.api-request');

            requests.forEach(request => {
                if (filter === 'all' || request.dataset.type === filter) {
                    request.style.display = 'block';
                } else {
                    request.style.display = 'none';
                }
            });
        });
    });

    // Auto-refresh des stats
    setInterval(() => {
        // Simulation de nouvelles donn√©es
        console.log('Refreshing API stats...');
    }, 10000);
</script>

</body>
</html>